<!DOCTYPE <!DOCTYPE html>
<html>
<head>
	<title>
		Chat
	</title>
	<meta charset="utf-8">
	<link rel="stylesheet" type="text/css" href="style.css">
	<script type="text/javascript" src="jquery-2.1.3.min.js"></script>
</head>
<body>

<div class="modal-container">
	<div id="login-div"></div>
</div>

	<div id="message-container"></div>

	<div id="head"></div>

	<div id="left"></div>

	<div id="server"></div>

	<div id="dialogs-head"></div>

	<div id="bottom">
		<div id="img"></div>
		<textarea id="textarea" placeholder="Enter your message"></textarea>
		<div id="send-message-button"></div>
	</div>

<script type="text/javascript">
	var textarea = document.getElementById("textarea");
	var messageContainer = document.getElementById("message-container");
	var sendOnEnter = true;

	function ModalContainer() {
		var div = document.createElement("div");
		div.className = "modal-container";
		return div;
	}

	function sendMessage() {
		var message = textarea.value;
		if(!message)
			return;
		//server?
		drawMessage(message, true);
		textarea.value = '';
	}

	function makeTextFitElement(text, element) {
		// if(!element)
		// 	element = document.body;
		// if(widthOfTextInElement(text, element) < 551)
			return text;
	}

	function widthOfTextInElement(text, element) {
		if(!element)
			element = document.body;
		var span = document.createElement("span");
		span.style.display = "none";
		span.innerHTML = text;
		element.appendChild(span);
		var width = $(span).width();
		element.removeChild(span);
		return width;
	}

	function drawMessage(textMessage, my)
	{
		var message = document.createElement("div");
		message.className = my ? "my-message" : "friend-message";

		var textDiv = document.createElement("div");

		var currentTime = new Date;
		var sendingTime = currentTime.toLocaleTimeString() + "<br>" + currentTime.toLocaleDateString();

		var time = document.createElement("time");
		time.innerHTML = sendingTime;

		message.appendChild(textDiv);
		message.appendChild(time);

		messageContainer.appendChild(message);
		textDiv.innerHTML = makeTextFitElement(textMessage, textDiv);		
		message.scrollIntoView();
	}

	document.getElementById("send-message-button").onclick = sendMessage;
	document.body.onkeypress = function(event) {
		if(event.keyCode < 32) return;
		textarea.focus();
	};

//---------------------------------------------------------
	var messages = ["Hello :)", "Hello :)", "How are you?"];
	var my = false;

	messages.forEach(function(message) {
		drawMessage(message, my);
		my = my ? false: true;
	})

</script>

</body>
</html>