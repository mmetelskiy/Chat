<!DOCTYPE <!DOCTYPE html>
<html>
<head>
	<title>
		Chat
	</title>
	<meta charset="utf-8">
	<link rel="stylesheet" type="text/css" href="./css/style.css">
	<link rel="stylesheet" type="text/css" href="./css/head.css">
	<link rel="stylesheet" type="text/css" href="./css/friends.css">
	<link rel="stylesheet" type="text/css" href="./css/server.css">
	<link rel="stylesheet" type="text/css" href="./css/dialogs-head.css">
	<link rel="stylesheet" type="text/css" href="./css/bottom.css">
	<link rel="stylesheet" type="text/css" href="./css/message-container.css">
	<link rel="stylesheet" type="text/css" href="./css/modals.css">
</head>
<body>
<div class="modal-container">
	<div id="login"></div>
</div>
	<div id="message-container"></div>
	<div id="head">
		<div id="icon"></div>
	</div>
	<div id="friends"></div>
	<div id="server"></div>
	<div id="dialogs-head"></div>
	<div id="bottom">
		<div id="img"></div>
		<textarea id="textarea" placeholder="Enter your message"></textarea>
		<div id="send-message-button">Send</div>
	</div>

<script type="text/javascript" src="jquery-2.1.3.min.js"></script>
<script type="text/javascript">

	var textarea = document.getElementById("textarea");
	var messageContainer = document.getElementById("message-container");
	var sendOnEnter = false;

	function ModalContainer() {
		var div = document.createElement("div");
		div.className = "modal-container";
		return div;
	}

	function sendMessage() {
		var message = textarea.value;
		if(!message)
			return;
		//server?
		drawMessage(message, true);
		textarea.value = '';
	}

	function makeTextFitElement(text, element) {
		// if(!element)
		// 	element = document.body;
		// if(widthOfTextInElement(text, element) < 551)
			return addLineDividers(text);
	}

	function addLineDividers(text) {
		return text.replace( /^\s+|\s+$/g, '' ).replace(/\r?\n/g, '<br>');
	}

	function widthOfTextInElement(text, element) {
		if(!element)
			element = document.body;
		var span = document.createElement("span");
		span.style.display = "none";
		span.innerHTML = text;
		element.appendChild(span);
		var width = $(span).width();
		element.removeChild(span);
		return width;
	}

	function drawMessage(textMessage, my) {
		var message = document.createElement("div");
		message.className = my ? "my-message" : "friend-message";

		var textDiv = document.createElement("div");

		var currentTime = new Date;
		var sendingTime = currentTime.toLocaleTimeString() + "<br>" + currentTime.toLocaleDateString();

		var time = document.createElement("time");
		time.innerHTML = sendingTime;

		message.appendChild(textDiv);
		message.appendChild(time);

		messageContainer.appendChild(message);
		textDiv.innerHTML = makeTextFitElement(textMessage, textDiv);		
		message.scrollIntoView();
	}

	document.getElementById("send-message-button").onclick = sendMessage;
	document.body.onkeypress = function(event) {
		if(event.keyCode == 13) {
			if(sendOnEnter)
				sendMessage();
			else textarea.value += '\n';
			return false;
		}
		else if(event.keyCode == 10) {
			if(sendOnEnter)
				textarea.value += '\n';
			else sendMessage();
			return false;
		}

		if(event.keyCode < 32) return;
		textarea.focus();
	};
	messageContainer.onmousedown = function (event) {
		function getMessage(target) {
			return target.classList.contains("my-message") ? target : null;
		}

		var message = getMessage(event.target);
		if(!message) return false;

		message.classList.toggle('selected-message');
		return false;
	};

//---------------------------------------------------------
	var messages = ["Hello :)", "Hello :)", "How are you?"];
	var my = false;

	messages.forEach(function(message) {
		drawMessage(message, my);
		my = my ? false: true;
	});

</script>

</body>
</html>